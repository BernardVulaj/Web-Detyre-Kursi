<!DOCTYPE html>
<html lang="en">
    <head>
        <title>
            Reset Password Page
        </title>
        <link rel="stylesheet" href="../css/resetPassword.css">

    </head>
    <body>
        <form id="form" >
       

            <h1 id="header">Ndrysho fjalekalimin</h1>

            <label id="mesazhi">Jepni fjalekalimin e ri</label>

            <label>Fjalekalimi</label>
            <input type="password" id="input" placeholder="Jepni 8 ose me shume karaktere">


            <label>Konfirmo fjalekalimin</label>
            <input type="password" id="confirmInput" placeholder="Jepni 8 ose me shume karaktere">

            <button id="konfirmo">KONFIRMO</button>
            <a href="login.html" id="kthehuTeLogin">KTHEHU TE LOGIN</a>

            
        </form>
        
        <script>

            document.getElementById("konfirmo").addEventListener("click", function(event){
                event.preventDefault();
                

                const password = document.getElementById("input").value;
                const confirmPassword = document.getElementById("confirmInput").value;

                const passwordRegex = /^(?=.*[A-Za-z])(?=.*[-._!#$%&?])[A-Za-z\d!#$%&?]{8,255}$/;
                if (!passwordRegex.test(password)) {
                    alert("Fjalekalimi duhet te kete se pakti 8 karaktere, nje shkronje dhe nje karakter special.");
                    return;
                }
                if (!passwordRegex.test(confirmPassword)) {
                    alert("Fjalekalimi duhet te kete se pakti 8 karaktere, nje shkronje dhe nje karakter special.");
                    return;
                }
                
                // Check if the passwords match
                if (password !== confirmPassword) {
                    alert("Fjalekalimet nuk jane te njejta");
                    return;
                }
                // Send password change request to PHP
                fetch('registerLogin.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ changedPassword: password, action: "changePassword"})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert("Fjalekalimi u ndryshua me sukses!");
                        window.location.href = "login.html";
                    } else {
                        alert("Error: " + data.message);
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("Ka ndodhur nje gabim gjate ndryshimit te fjalekalimit.");
                });
            });
        </script>
        <script src="sessionTimeout.js"></script>


    </body>
</html>